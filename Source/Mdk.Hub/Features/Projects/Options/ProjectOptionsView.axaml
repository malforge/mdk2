<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:options="clr-namespace:Mdk.Hub.Features.Projects.Options"
             xmlns:controls="clr-namespace:Mdk.Hub.Framework.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Mdk.Hub.Features.Projects.Options.ProjectOptionsView"
             x:DataType="options:ProjectOptionsViewModel"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             Background="Transparent">

    <DockPanel LastChildFill="True">
        <!-- Header at top -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,16">
            <TextBlock Grid.Column="0"
                       Text="{Binding ProjectName, StringFormat='Options - {0}'}"
                       Classes="page-title" />
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center"
                        IsVisible="{Binding HasUnsavedChanges}">
                <Ellipse Width="8" Height="8" Classes="warning-indicator" />
                <TextBlock Text="Unsaved changes"
                           Classes="caption warning"
                           FontStyle="Italic" />
            </StackPanel>
        </Grid>

        <!-- Buttons at bottom -->
        <StackPanel DockPanel.Dock="Bottom"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8"
                    Margin="0,16,0,0"
                    IsVisible="{Binding IsStandardConfiguration}">
            <Button Content="Save"
                    Command="{Binding SaveCommand}"
                    MinWidth="75" />
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Classes="subtle"
                    MinWidth="75" />
        </StackPanel>

        <!-- Content: Either simple editor or non-standard message -->
        <Grid>
            <!-- Simple Editor (for standard configurations) -->
            <ScrollViewer IsVisible="{Binding IsStandardConfiguration}">
                <StackPanel Spacing="24" Margin="0,0,12,0">
                    
                    <!-- Project Settings Section -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="Project Settings"
                                   Classes="subtitle"
                                   Margin="0,0,0,4" />
                        <TextBlock Text="Shared configuration committed to source control (mdk.ini)"
                                   Classes="caption muted"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,8" />

                        <!-- Minify (ProgrammableBlock only) -->
                        <Grid ColumnDefinitions="*,8,*" IsVisible="{Binding IsProgrammableBlock}">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="Minify" Classes="label muted" />
                                <controls:ValidatedControl>
                                    <controls:ValidatedControl.Content>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyOptionsList}"
                                                  SelectedItem="{Binding MainConfig.Minify}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </controls:ValidatedControl.Content>
                                </controls:ValidatedControl>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="Minify Extra Options" Classes="label muted" />
                                <controls:ValidatedControl>
                                    <controls:ValidatedControl.Content>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyExtraOptionsList}"
                                                  SelectedItem="{Binding MainConfig.MinifyExtraOptions}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </controls:ValidatedControl.Content>
                                </controls:ValidatedControl>
                            </StackPanel>
                        </Grid>

                        <!-- Namespaces (ProgrammableBlock only) -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsProgrammableBlock}">
                            <TextBlock Text="Namespaces" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <TextBox Text="{Binding MainConfig.Namespaces}" />
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>

                        <!-- Ignores -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Ignores" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <TextBox Text="{Binding MainConfig.Ignores}" />
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>

                        <!-- Trace -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Trace" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.TraceOptionsList}"
                                              SelectedItem="{Binding MainConfig.Trace}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>
                    </StackPanel>

                    <!-- Local Machine Settings Section -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="Local Machine Settings"
                                   Classes="subtitle"
                                   Margin="0,0,0,4" />
                        <TextBlock Text="Machine-specific settings not committed to source control (mdk.local.ini)"
                                   Classes="caption muted"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,8" />

                        <!-- When Build Completes -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="When Build Completes" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.InteractiveOptionsList}"
                                              SelectedItem="{Binding MainConfig.Interactive}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>

                        <!-- Output Path -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Output Path" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <controls:PathInput Path="{Binding MainConfig.OutputPath}"
                                                       DefaultPath="auto"
                                                       CanReset="True"
                                                       ResetTooltip="Reset to Auto-detect" />
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>

                        <!-- Binary Path -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Binary Path" Classes="label muted" />
                            <controls:ValidatedControl>
                                <controls:ValidatedControl.Content>
                                    <controls:PathInput Path="{Binding MainConfig.BinaryPath}"
                                                       DefaultPath="auto"
                                                       CanReset="True"
                                                       ResetTooltip="Reset to Auto-detect" />
                                </controls:ValidatedControl.Content>
                            </controls:ValidatedControl>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Non-Standard Configuration Message -->
            <StackPanel IsVisible="{Binding !IsStandardConfiguration}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        MaxWidth="600"
                        Spacing="16">
                <TextBlock Text="⚠️ Non-Standard Configuration"
                           Classes="subtitle"
                           HorizontalAlignment="Center" />
                <TextBlock Text="This project uses a non-standard configuration that requires manual editing."
                           TextWrapping="Wrap"
                           TextAlignment="Center"
                           Classes="body" />
                <TextBlock TextWrapping="Wrap"
                           TextAlignment="Center"
                           Classes="caption muted">
                    <Run Text="To use this editor, your configuration must follow the standard:"/>
                    <LineBreak/>
                    <Run Text="• mdk.ini: Project settings (type, namespaces, ignores, minifier)"/>
                    <LineBreak/>
                    <Run Text="• mdk.local.ini: Machine-specific settings (paths, notifications)"/>
                </TextBlock>
                <TextBlock TextWrapping="Wrap"
                           TextAlignment="Center"
                           Classes="body">
                    <Run Text="You can continue editing your INI files manually, or migrate to the standard configuration."/>
                </TextBlock>
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Spacing="8"
                            Margin="0,8,0,0">
                    <Button Content="Fix it"
                            Command="{Binding NormalizeConfigurationCommand}"
                            MinWidth="150" />
                    <Button Content="Close"
                            Command="{Binding CancelCommand}"
                            Classes="subtle"
                            MinWidth="100" />
                </StackPanel>
            </StackPanel>
        </Grid>
    </DockPanel>
</UserControl>
