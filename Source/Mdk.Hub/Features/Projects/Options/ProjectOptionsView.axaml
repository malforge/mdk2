<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:options="clr-namespace:Mdk.Hub.Features.Projects.Options"
             xmlns:controls="clr-namespace:Mdk.Hub.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Mdk.Hub.Features.Projects.Options.ProjectOptionsView"
             x:DataType="options:ProjectOptionsViewModel"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             Background="Transparent">

    <DockPanel LastChildFill="True">
        <!-- Header at top -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,16">
            <TextBlock Grid.Column="0"
                       Text="{Binding ProjectName, StringFormat='Options - {0}'}"
                       Classes="page-title" />
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center"
                        IsVisible="{Binding HasUnsavedChanges}">
                <Ellipse Width="8" Height="8" Classes="warning-indicator" />
                <TextBlock Text="Unsaved changes"
                           Classes="caption warning"
                           FontStyle="Italic" />
            </StackPanel>
        </Grid>

        <!-- Buttons at bottom -->
        <StackPanel DockPanel.Dock="Bottom"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8"
                    Margin="0,16,0,0">
            <Button Content="Save"
                    Command="{Binding SaveCommand}"
                    MinWidth="75" />
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Classes="subtle"
                    MinWidth="75" />
        </StackPanel>

        <!-- Tabs fill remaining space -->
        <TabControl SelectedIndex="1">
            <!-- Main INI Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Spacing="2">
                        <TextBlock Text="Main" />
                        <TextBlock Text="mdk.ini" Classes="caption muted" />
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer>
                    <StackPanel Spacing="12" Margin="0,12,12,0">
                        <TextBlock
                            Text="Shared project configuration, committed to source control. Settings here apply to all developers."
                            Classes="label muted"
                            TextWrapping="Wrap"
                            MinHeight="28"
                            Margin="0,0,0,8" />

                        <!-- Build Notifications -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="When Build Completes"
                                           Classes="label muted" />
                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4"
                                            IsVisible="{Binding IsInteractiveOverridden}">
                                    <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                    <TextBlock Text="Overridden in Local"
                                               Classes="label warning"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                            <ComboBox
                                ItemsSource="{x:Static options:ConfigurationSectionViewModel.InteractiveOptionsList}"
                                SelectedItem="{Binding MainConfig.Interactive}"
                                HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Display}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <!-- Output Path -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Output Path"
                                           Classes="label muted" />
                            </Grid>
                            <controls:PathSelectorControl Path="{Binding MainConfig.OutputPath}"
                                                          DefaultPath="{Binding DefaultOutputPath}"
                                                          DefaultText="Auto" />
                        </StackPanel>

                        <!-- Binary Path -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Binary Path"
                                           Classes="label muted" />
                            </Grid>
                            <controls:PathSelectorControl Path="{Binding MainConfig.BinaryPath}"
                                                          DefaultPath="{Binding DefaultBinaryPath}"
                                                          DefaultText="Auto" />
                        </StackPanel>

                        <!-- Minify -->
                        <Grid ColumnDefinitions="*,8,*" IsVisible="{Binding IsProgrammableBlock}">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                    <TextBlock Grid.Column="0"
                                               Text="Minify"
                                               Classes="label muted" />
                                    <StackPanel Grid.Column="1"
                                                Orientation="Horizontal"
                                                Spacing="4"
                                                IsVisible="{Binding IsMinifyOverridden}">
                                        <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                        <TextBlock Text="Overridden in Local"
                                                   Classes="label warning"
                                                   FontStyle="Italic"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </Grid>
                                <ComboBox
                                    ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyOptionsList}"
                                    SelectedItem="{Binding MainConfig.Minify}"
                                    HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Display}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                    <TextBlock Grid.Column="0"
                                               Text="Minify Extra Options"
                                               Classes="label muted" />
                                    <StackPanel Grid.Column="1"
                                                Orientation="Horizontal"
                                                Spacing="4"
                                                IsVisible="{Binding IsMinifyExtraOptionsOverridden}">
                                        <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                        <TextBlock Text="Overridden in Local"
                                                   Classes="label warning"
                                                   FontStyle="Italic"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </Grid>
                                <ComboBox
                                    ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyExtraOptionsList}"
                                    SelectedItem="{Binding MainConfig.MinifyExtraOptions}"
                                    HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Display}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>
                        </Grid>

                        <!-- Trace -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Trace"
                                           Classes="label muted" />
                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4"
                                            IsVisible="{Binding IsTraceOverridden}">
                                    <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                    <TextBlock Text="Overridden in Local"
                                               Classes="label warning"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                            <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.TraceOptionsList}"
                                      SelectedItem="{Binding MainConfig.Trace}"
                                      HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Display}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <!-- Ignores -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Ignores"
                                           Classes="label muted" />
                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4"
                                            IsVisible="{Binding IsIgnoresOverridden}">
                                    <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                    <TextBlock Text="Overridden in Local"
                                               Classes="label warning"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                            <TextBox Text="{Binding MainConfig.Ignores}" />
                        </StackPanel>

                        <!-- Namespaces -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsProgrammableBlock}">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Namespaces"
                                           Classes="label muted" />
                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4"
                                            IsVisible="{Binding IsNamespacesOverridden}">
                                    <TextBlock Text="⚠️" Classes="label" VerticalAlignment="Center" />
                                    <TextBlock Text="Overridden in Local"
                                               Classes="label warning"
                                               FontStyle="Italic"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                            <TextBox Text="{Binding MainConfig.Namespaces}" />
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Local INI Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Spacing="2">
                        <TextBlock Text="Local" />
                        <TextBlock Text="mdk.local.ini" Classes="caption muted" />
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer>
                    <StackPanel Spacing="12" Margin="0,12,12,0">
                        <TextBlock
                            Text="Local overrides, gitignored and not committed. Settings here override Main settings and are specific to your machine."
                            Classes="label muted"
                            TextWrapping="Wrap"
                            MinHeight="28"
                            Margin="0,0,0,8" />

                        <!-- Build Notifications -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="When Build Completes"
                                       Classes="label muted" />
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0"
                                          ItemsSource="{x:Static options:ConfigurationSectionViewModel.InteractiveOptionsList}"
                                          SelectedItem="{Binding LocalConfig.Interactive}"
                                          HorizontalAlignment="Stretch"
                                          PlaceholderText="(inherits from Main)">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Display}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalInteractiveCommand}"
                                        IsEnabled="{Binding LocalConfig.Interactive, Converter={x:Static ObjectConverters.IsNotNull}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>

                        <!-- Output Path -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Output Path"
                                           Classes="label muted" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <controls:PathSelectorControl Grid.Column="0"
                                                              Path="{Binding LocalConfig.OutputPath}"
                                                              DefaultPath="{Binding DefaultOutputPath}"
                                                              DefaultText="Auto"
                                                              Watermark="(inherits from Main)" />
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalOutputPathCommand}"
                                        IsEnabled="{Binding LocalConfig.OutputPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>

                        <!-- Binary Path -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Binary Path"
                                           Classes="label muted" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <controls:PathSelectorControl Grid.Column="0"
                                                              Path="{Binding LocalConfig.BinaryPath}"
                                                              DefaultPath="{Binding DefaultBinaryPath}"
                                                              DefaultText="Auto"
                                                              Watermark="(inherits from Main)" />
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalBinaryPathCommand}"
                                        IsEnabled="{Binding LocalConfig.BinaryPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>

                        <!-- Minify -->
                        <Grid ColumnDefinitions="*,8,*" IsVisible="{Binding IsProgrammableBlock}">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                    <TextBlock Grid.Column="0"
                                               Text="Minify"
                                               Classes="label muted" />
                                </Grid>
                                <Grid ColumnDefinitions="*,Auto">
                                    <ComboBox Grid.Column="0"
                                              ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyOptionsList}"
                                              SelectedItem="{Binding LocalConfig.Minify}"
                                              PlaceholderText="(inherits from Main)"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                    <Button Grid.Column="1"
                                            Content="✕"
                                            Command="{Binding ClearLocalMinifyCommand}"
                                            IsEnabled="{Binding LocalConfig.Minify, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            Margin="5,0,0,0"
                                            VerticalAlignment="Center"
                                            ToolTip.Tip="Clear (inherit from Main)" />
                                </Grid>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                    <TextBlock Grid.Column="0"
                                               Text="Minify Extra Options"
                                               Classes="label muted" />
                                </Grid>
                                <Grid ColumnDefinitions="*,Auto">
                                    <ComboBox Grid.Column="0"
                                              ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyExtraOptionsList}"
                                              SelectedItem="{Binding LocalConfig.MinifyExtraOptions}"
                                              PlaceholderText="(inherits from Main)"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                    <Button Grid.Column="1"
                                            Content="✕"
                                            Command="{Binding ClearLocalMinifyExtraOptionsCommand}"
                                            IsEnabled="{Binding LocalConfig.MinifyExtraOptions, Converter={x:Static ObjectConverters.IsNotNull}}"
                                            Margin="5,0,0,0"
                                            VerticalAlignment="Center"
                                            ToolTip.Tip="Clear (inherit from Main)" />
                                </Grid>
                            </StackPanel>
                        </Grid>

                        <!-- Trace -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Trace"
                                           Classes="label muted" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <ComboBox Grid.Column="0"
                                          ItemsSource="{x:Static options:ConfigurationSectionViewModel.TraceOptionsList}"
                                          SelectedItem="{Binding LocalConfig.Trace}"
                                          PlaceholderText="(inherits from Main)"
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Display}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalTraceCommand}"
                                        IsEnabled="{Binding LocalConfig.Trace, Converter={x:Static ObjectConverters.IsNotNull}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>

                        <!-- Ignores -->
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Ignores"
                                           Classes="label muted" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0"
                                         Text="{Binding LocalConfig.Ignores}"
                                         Watermark="(inherits from Main)" />
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalIgnoresCommand}"
                                        IsEnabled="{Binding LocalConfig.Ignores, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>

                        <!-- Namespaces -->
                        <StackPanel Spacing="4" IsVisible="{Binding IsProgrammableBlock}">
                            <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                <TextBlock Grid.Column="0"
                                           Text="Namespaces"
                                           Classes="label muted" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0"
                                         Text="{Binding LocalConfig.Namespaces}"
                                         Watermark="(inherits from Main)" />
                                <Button Grid.Column="1"
                                        Content="✕"
                                        Command="{Binding ClearLocalNamespacesCommand}"
                                        IsEnabled="{Binding LocalConfig.Namespaces, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Clear (inherit from Main)" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </DockPanel>
</UserControl>