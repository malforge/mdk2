<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:options="clr-namespace:Mdk.Hub.Features.Projects.Options"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Mdk.Hub.Features.Projects.Options.ProjectOptionsView"
             x:DataType="options:ProjectOptionsViewModel"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             Background="Transparent">
    
    <DockPanel LastChildFill="True">
        <!-- Header at top -->
        <TextBlock DockPanel.Dock="Top"
                   Text="{Binding ProjectName, StringFormat='Options - {0}'}"
                   Foreground="#FFe0e0e0"
                   FontSize="20"
                   FontWeight="Bold"
                   Margin="0,0,0,16"/>
        
        <!-- Buttons at bottom -->
        <StackPanel DockPanel.Dock="Bottom"
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Spacing="8"
                    Margin="0,16,0,0">
            <Button Content="Save"
                    Command="{Binding SaveCommand}"
                    MinWidth="75"/>
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Classes="subtle"
                    MinWidth="75"/>
        </StackPanel>
        
        <!-- Tabs fill remaining space -->
        <TabControl>
                    <!-- Main INI Tab -->
                    <TabItem Header="Main (mdk.ini)">
                        <ScrollViewer>
                            <StackPanel Spacing="12" Margin="0,12,12,0">
                                <TextBlock Text="Shared project configuration, committed to source control. Settings here apply to all developers."
                                           Foreground="#FF808080"
                                           FontSize="10"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8"/>
                                
                                <!-- Output Path -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Output Path"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal" 
                                                    Spacing="4"
                                                    IsVisible="{Binding IsOutputOverridden}">
                                            <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                            <TextBlock Text="Overridden in Local"
                                                       Foreground="#FFffa500"
                                                       FontSize="10"
                                                       FontStyle="Italic"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <TextBox Text="{Binding MainConfig.OutputPath}"
                                             Watermark="auto"/>
                                </StackPanel>
                                
                                <!-- Binary Path -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Binary Path"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal" 
                                                    Spacing="4"
                                                    IsVisible="{Binding IsBinaryPathOverridden}">
                                            <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                            <TextBlock Text="Overridden in Local"
                                                       Foreground="#FFffa500"
                                                       FontSize="10"
                                                       FontStyle="Italic"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <TextBox Text="{Binding MainConfig.BinaryPath}"
                                             Watermark="auto"/>
                                </StackPanel>
                                
                                <!-- Minify -->
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                            <TextBlock Grid.Column="0"
                                                       Text="Minify"
                                                       Foreground="#FFb0b0b0"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"/>
                                            <StackPanel Grid.Column="1" 
                                                        Orientation="Horizontal" 
                                                        Spacing="4"
                                                        IsVisible="{Binding IsMinifyOverridden}">
                                                <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                                <TextBlock Text="Overridden in Local"
                                                           Foreground="#FFffa500"
                                                           FontSize="10"
                                                           FontStyle="Italic"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyOptionsList}"
                                                  SelectedItem="{Binding MainConfig.Minify}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                            <TextBlock Grid.Column="0"
                                                       Text="Minify Extra Options"
                                                       Foreground="#FFb0b0b0"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"/>
                                            <StackPanel Grid.Column="1" 
                                                        Orientation="Horizontal" 
                                                        Spacing="4"
                                                        IsVisible="{Binding IsMinifyExtraOptionsOverridden}">
                                                <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                                <TextBlock Text="Overridden in Local"
                                                           Foreground="#FFffa500"
                                                           FontSize="10"
                                                           FontStyle="Italic"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyExtraOptionsList}"
                                                  SelectedItem="{Binding MainConfig.MinifyExtraOptions}"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Trace -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Trace"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal" 
                                                    Spacing="4"
                                                    IsVisible="{Binding IsTraceOverridden}">
                                            <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                            <TextBlock Text="Overridden in Local"
                                                       Foreground="#FFffa500"
                                                       FontSize="10"
                                                       FontStyle="Italic"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.TraceOptionsList}"
                                              SelectedItem="{Binding MainConfig.Trace}"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                                
                                <!-- Ignores -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Ignores"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal" 
                                                    Spacing="4"
                                                    IsVisible="{Binding IsIgnoresOverridden}">
                                            <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                            <TextBlock Text="Overridden in Local"
                                                       Foreground="#FFffa500"
                                                       FontSize="10"
                                                       FontStyle="Italic"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <TextBox Text="{Binding MainConfig.Ignores}"
                                             AcceptsReturn="True"
                                             Height="60"/>
                                </StackPanel>
                                
                                <!-- Namespaces -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Namespaces"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal" 
                                                    Spacing="4"
                                                    IsVisible="{Binding IsNamespacesOverridden}">
                                            <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center"/>
                                            <TextBlock Text="Overridden in Local"
                                                       Foreground="#FFffa500"
                                                       FontSize="10"
                                                       FontStyle="Italic"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                    <TextBox Text="{Binding MainConfig.Namespaces}"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                    
                    <!-- Local INI Tab -->
                    <TabItem Header="Local (mdk.local.ini)">
                        <ScrollViewer>
                            <StackPanel Spacing="12" Margin="0,12,12,0">
                                <TextBlock Text="Local overrides, gitignored and not committed. Settings here override Main settings and are specific to your machine."
                                           Foreground="#FF808080"
                                           FontSize="10"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8"/>
                                
                                <!-- Output Path -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Output Path"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <Button Grid.Column="1"
                                                Classes="subtle"
                                                Content="Clear"
                                                FontSize="10"
                                                Padding="6,2"
                                                Command="{Binding ClearLocalOutputPathCommand}"
                                                IsEnabled="{Binding LocalConfig.OutputPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Grid>
                                    <TextBox Text="{Binding LocalConfig.OutputPath}"
                                             Watermark="(inherits from Main)"/>
                                </StackPanel>
                                
                                <!-- Binary Path -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Binary Path"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <Button Grid.Column="1"
                                                Classes="subtle"
                                                Content="Clear"
                                                FontSize="10"
                                                Padding="6,2"
                                                Command="{Binding ClearLocalBinaryPathCommand}"
                                                IsEnabled="{Binding LocalConfig.BinaryPath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Grid>
                                    <TextBox Text="{Binding LocalConfig.BinaryPath}"
                                             Watermark="(inherits from Main)"/>
                                </StackPanel>
                                
                                <!-- Minify -->
                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                            <TextBlock Grid.Column="0"
                                                       Text="Minify"
                                                       Foreground="#FFb0b0b0"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"/>
                                            <Button Grid.Column="1"
                                                    Classes="subtle"
                                                    Content="Clear"
                                                    FontSize="10"
                                                    Padding="6,2"
                                                    Command="{Binding ClearLocalMinifyCommand}"
                                                    IsEnabled="{Binding LocalConfig.Minify, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                        </Grid>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyOptionsList}"
                                                  SelectedItem="{Binding LocalConfig.Minify}"
                                                  PlaceholderText="(inherits from Main)"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                            <TextBlock Grid.Column="0"
                                                       Text="Minify Extra Options"
                                                       Foreground="#FFb0b0b0"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"/>
                                            <Button Grid.Column="1"
                                                    Classes="subtle"
                                                    Content="Clear"
                                                    FontSize="10"
                                                    Padding="6,2"
                                                    Command="{Binding ClearLocalMinifyExtraOptionsCommand}"
                                                    IsEnabled="{Binding LocalConfig.MinifyExtraOptions, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                        </Grid>
                                        <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.MinifyExtraOptionsList}"
                                                  SelectedItem="{Binding LocalConfig.MinifyExtraOptions}"
                                                  PlaceholderText="(inherits from Main)"
                                                  HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Display}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Trace -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Trace"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <Button Grid.Column="1"
                                                Classes="subtle"
                                                Content="Clear"
                                                FontSize="10"
                                                Padding="6,2"
                                                Command="{Binding ClearLocalTraceCommand}"
                                                IsEnabled="{Binding LocalConfig.Trace, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                    </Grid>
                                    <ComboBox ItemsSource="{x:Static options:ConfigurationSectionViewModel.TraceOptionsList}"
                                              SelectedItem="{Binding LocalConfig.Trace}"
                                              PlaceholderText="(inherits from Main)"
                                              HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Display}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                                
                                <!-- Ignores -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Ignores"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <Button Grid.Column="1"
                                                Classes="subtle"
                                                Content="Clear"
                                                FontSize="10"
                                                Padding="6,2"
                                                Command="{Binding ClearLocalIgnoresCommand}"
                                                IsEnabled="{Binding LocalConfig.Ignores, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Grid>
                                    <TextBox Text="{Binding LocalConfig.Ignores}"
                                             AcceptsReturn="True"
                                             Height="60"
                                             Watermark="(inherits from Main)"/>
                                </StackPanel>
                                
                                <!-- Namespaces -->
                                <StackPanel Spacing="4">
                                    <Grid ColumnDefinitions="*,Auto" MinHeight="20">
                                        <TextBlock Grid.Column="0"
                                                   Text="Namespaces"
                                                   Foreground="#FFb0b0b0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                        <Button Grid.Column="1"
                                                Classes="subtle"
                                                Content="Clear"
                                                FontSize="10"
                                                Padding="6,2"
                                                Command="{Binding ClearLocalNamespacesCommand}"
                                                IsEnabled="{Binding LocalConfig.Namespaces, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Grid>
                                    <TextBox Text="{Binding LocalConfig.Namespaces}"
                                             Watermark="(inherits from Main)"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
    </DockPanel>
</UserControl>


