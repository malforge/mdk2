<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:actions="clr-namespace:Mdk.Hub.Features.Projects.Actions"
             xmlns:overview="clr-namespace:Mdk.Hub.Features.Projects.Overview"
             xmlns:controls="clr-namespace:Mdk.Hub.Framework.Controls"
             xmlns:icons="clr-namespace:Mdk.Hub.Features.Projects.Overview.Icons"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="600"
             x:Class="Mdk.Hub.Features.Projects.Actions.ProjectActionsView"
             x:DataType="actions:ProjectActionsViewModel">
    <UserControl.Resources>
        <actions:BoolToDeploymentStatusConverter x:Key="BoolToDeploymentStatusConverter" />
        <actions:BoolToWarningBackgroundConverter x:Key="BoolToWarningBackgroundConverter" />
    </UserControl.Resources>
    
    <Design.DataContext>
        <actions:ProjectActionsViewModel />
    </Design.DataContext>

    <UserControl.Styles>
        <StyleInclude Source="avares://Mdk.Hub/Features/Projects/Actions/Styles.axaml" />
    </UserControl.Styles>

    <UserControl.DataTemplates>
        <icons:SymbolSelector>
            <icons:ProjectTypeDefinition Type="IngameScript">
                <DataTemplate>
                    <icons:ProgrammableBlockSymbol />
                </DataTemplate>
            </icons:ProjectTypeDefinition>
            <icons:ProjectTypeDefinition Type="Mod">
                <DataTemplate>
                    <icons:ModSymbol />
                </DataTemplate>
            </icons:ProjectTypeDefinition>
        </icons:SymbolSelector>
        
        <!-- Create Project Action -->
        <DataTemplate DataType="actions:CreateProjectAction">
            <StackPanel Spacing="8" Margin="16,0">
                <TextBlock Classes="section-title" Text="Projects" />
                <ItemsControl ItemsSource="{Binding Options}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Spacing="2" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Classes="create-hover-row" Padding="10" CornerRadius="4" Cursor="Hand">
                                <Grid ColumnDefinitions="Auto,*">
                                    <ContentControl Content="{Binding ProjectType}" Width="32" Height="32" Grid.Column="0" />
                                    <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center" Spacing="1">
                                        <TextBlock Text="{Binding Title}" FontSize="13" FontWeight="Medium" />
                                        <TextBlock Text="{Binding Description}" FontSize="11" Foreground="#FF999999" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- Add Existing Project -->
                <Border Classes="create-hover-row" 
                        Padding="10" 
                        CornerRadius="4" 
                        Cursor="Hand"
                        Tapped="OnAddExistingProjectTapped"
                        Tag="{Binding AddExistingAction}">
                    <Grid ColumnDefinitions="Auto,*">
                        <i:Icon Value="fa-solid fa-folder-open" 
                                FontSize="18" 
                                Width="32" 
                                Height="32" 
                                Grid.Column="0"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center" />
                        <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center" Spacing="1">
                            <TextBlock Text="Add Existing Project" FontSize="13" FontWeight="Medium" />
                            <TextBlock Text="Open an existing MDK2 project" FontSize="11" Foreground="#FF999999" />
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>
        </DataTemplate>

        <!-- Category Separator -->
        <DataTemplate DataType="actions:CategorySeparator">
            <Border Height="1" Background="#44ffffff" Margin="0,12" />
        </DataTemplate>

        <!-- Project Info -->
        <DataTemplate DataType="actions:ProjectInfoAction">
            <StackPanel Spacing="12" Margin="16,0">
                <!-- Project header -->
                <StackPanel Spacing="12" Orientation="Horizontal">
                    <ContentControl Content="{Binding Project.Type}" Width="48" Height="48" />
                    <StackPanel Spacing="4" VerticalAlignment="Center">
                        <TextBlock Classes="section-title" Text="{Binding Project.Name}" />
                        <TextBlock Classes="info-label" Text="{Binding ProjectTypeName}" />
                    </StackPanel>
                </StackPanel>
                
                <!-- Info grid -->
                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="16" RowSpacing="8">
                    <!-- Row 1: Deployment Status | Last Deployed -->
                    <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4" 
                                HorizontalAlignment="Left" VerticalAlignment="Top">
                        <TextBlock Classes="info-label" Text="Deployment Status:" />
                        <TextBlock Classes="info-value" Text="{Binding IsDeployed, Converter={StaticResource BoolToDeploymentStatusConverter}}" />
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Grid.Row="0" Spacing="4" 
                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                IsVisible="{Binding IsDeployed}">
                        <TextBlock Classes="info-label" Text="Last Deployed:" />
                        <controls:DateTimeDisplay Value="{Binding LastDeployed}" />
                    </StackPanel>
                    
                    <!-- Row 2: Last Changed (full width) -->
                    <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Spacing="4"
                                HorizontalAlignment="Left" VerticalAlignment="Top">
                        <TextBlock Classes="info-label" Text="Last Changed:" />
                        <controls:DateTimeDisplay Value="{Binding LastChanged}" />
                    </StackPanel>
                    
                    <!-- Row 3: Script Size (full width, highlighted if over limit) -->
                    <Border Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2" 
                            IsVisible="{Binding IsScript}"
                            Background="{Binding IsScriptTooLarge, Converter={StaticResource BoolToWarningBackgroundConverter}}"
                            CornerRadius="4"
                            Padding="8"
                            ClipToBounds="True"
                            HorizontalAlignment="Stretch">
                        <StackPanel Spacing="4">
                            <TextBlock Classes="info-label" Text="Script Size:" />
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Classes="info-value" Text="{Binding ScriptSizeCharacters, StringFormat='{}{0:N0} characters'}" />
                                <TextBlock Classes="info-value" 
                                           Text="âš  Exceeds SE limit (100,000 characters)" 
                                           Foreground="#FFff6666"
                                           FontWeight="Bold"
                                           IsVisible="{Binding IsScriptTooLarge}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
                
                <!-- Action toolbar -->
                <Border Classes="action-toolbar" Padding="8" CornerRadius="4" Background="#11ffffff">
                    <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
                        <Button Classes="toolbar-button" ToolTip.Tip="Open in IDE">
                            <i:Icon Value="fa-solid fa-code" FontSize="16" />
                        </Button>
                        <Button Classes="toolbar-button" ToolTip.Tip="Options">
                            <i:Icon Value="fa-solid fa-cog" FontSize="16" />
                        </Button>
                        <Button Classes="toolbar-button" ToolTip.Tip="Copy Script to Clipboard"
                                IsVisible="{Binding IsScript}">
                            <i:Icon Value="fa-solid fa-copy" FontSize="16" />
                        </Button>
                        <Border Width="1" Height="24" Background="#33ffffff" Margin="4,0" />
                        <Button Classes="toolbar-button danger" ToolTip.Tip="Delete Project"
                                Command="{Binding Project.DeleteCommand}">
                            <i:Icon Value="fa-solid fa-trash" FontSize="16" />
                        </Button>
                    </StackPanel>
                </Border>
            </StackPanel>
        </DataTemplate>

        <!-- Project Action Button -->
        <DataTemplate DataType="actions:ProjectAction">
            <Button Classes="action-button" Content="{Binding Title}" HorizontalAlignment="Stretch" Margin="16,0" />
        </DataTemplate>
    </UserControl.DataTemplates>

    <ScrollViewer>
        <ItemsControl ItemsSource="{Binding Actions}" Margin="0,16">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Spacing="8" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>
    </ScrollViewer>
</UserControl>
